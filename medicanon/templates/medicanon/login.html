{% extends 'medicanon/base.html' %}
{% block title %}Connexion{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-soft flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-md w-full space-y-8">
        <!-- Header -->
        <div class="text-center">
            <div class="w-20 h-20 bg-gradient-medical rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"></path>
                </svg>
            </div>
            <h1 class="text-3xl font-bold text-neutral-900 mb-2">Connexion Sécurisée</h1>
            <p class="text-neutral-600 mb-6">Accédez à votre espace d'anonymisation médicale</p>
        </div>

        <!-- Carte principale -->
        <div class="card">
            <!-- Sélecteur de type de compte -->
            <div class="mb-6">
                <p class="text-sm font-medium text-neutral-700 mb-3">Type de compte</p>
                <div class="flex rounded-lg border border-neutral-200 p-1 bg-neutral-50">
                    <button id="btn-visiteur" type="button" class="account-type-btn active flex-1 flex items-center justify-center px-4 py-2 rounded-md text-sm font-medium transition-all duration-200">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        Visiteur
                    </button>
                    <button id="btn-agent-admin" type="button" class="account-type-btn flex-1 flex items-center justify-center px-4 py-2 rounded-md text-sm font-medium transition-all duration-200">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                        </svg>
                        Agent/Admin
                    </button>
                </div>
            </div>

            <!-- Bandeau informatif -->
            <div id="bandeau-info" class="mb-6 p-4 bg-medic-50 border border-medic-200 rounded-lg">
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-medic-100 rounded-full flex items-center justify-center mr-3">
                        <svg class="w-4 h-4 text-medic-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-medic-800 mb-1">Compte Visiteur</p>
                        <p class="text-xs text-medic-600">Accès aux téléchargements sécurisés du Hub Public</p>
                    </div>
                </div>
            </div>

            <!-- Messages d'erreur -->
            {% if messages %}
                {% for message in messages %}
                    <div class="mb-4 p-4 rounded-lg border {% if message.tags == 'error' %}bg-danger-50 border-danger-200 text-danger-800{% else %}bg-medic-50 border-medic-200 text-medic-800{% endif %}">
                        <div class="flex items-center">
                            {% if message.tags == 'error' %}
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                </svg>
                            {% endif %}
                            <span class="text-sm font-medium">{{ message }}</span>
                        </div>
                    </div>
                {% endfor %}
            {% endif %}

            <!-- Formulaire de connexion -->
            <form method="post" class="space-y-6">
                {% csrf_token %}

                <!-- Champ Email/Username -->
                <div class="form-group">
                    <label for="id_username" class="form-label">
                        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        Nom d'utilisateur
                    </label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg class="w-5 h-5 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                        </div>
                        <input type="text" 
                               name="username" 
                               id="id_username"
                               class="form-input pl-10" 
                               placeholder="Votre nom d'utilisateur" 
                               required 
                               autocomplete="username">
                    </div>
                </div>

                <!-- Champ Mot de passe -->
                <div class="form-group">
                    <label for="id_password" class="form-label">
                        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                        </svg>
                        Mot de passe
                    </label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg class="w-5 h-5 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                            </svg>
                        </div>
                        <input type="password" 
                               name="password" 
                               id="id_password"
                               class="form-input pl-10" 
                               placeholder="Votre mot de passe" 
                               required 
                               autocomplete="current-password">
                        <button type="button" 
                                id="toggle-password" 
                                class="absolute inset-y-0 right-0 pr-3 flex items-center text-neutral-400 hover:text-neutral-600">
                            <svg id="eye-open" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                            </svg>
                            <svg id="eye-closed" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Checkbox Se souvenir de moi -->
                <!-- <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <input type="checkbox" 
                               id="remember_me" 
                               name="remember_me" 
                               class="form-checkbox">
                        <label for="remember_me" class="ml-2 text-sm text-neutral-700">
                            Se souvenir de moi
                        </label>
                    </div>
                    <a href="{% url 'password_reset' %}" class="text-sm text-medic-600 hover:text-medic-700 hover:underline">
                        Mot de passe oublié ?
                    </a>
                </div> -->

                <!-- Bouton de connexion -->
                <button type="submit" 
                        class="btn btn-primary w-full btn-lg">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path>
                    </svg>
                    Se connecter
                </button>

                <!-- Liens supplémentaires -->
                <div class="text-center space-y-2">
                    <p class="text-sm text-neutral-600">
                        Vous n'avez pas encore de compte ?
                    </p>
                    <a href="{% url 'register' %}" class="btn btn-outline-primary w-full">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path>
                        </svg>
                        Créer un compte
                    </a>
                </div>
            </form>
        </div>

        <!-- Conformité réglementaire -->
        <div class="mt-8 space-y-4">
            <!-- Badges de conformité -->
            <div class="flex justify-center space-x-4">
                <div class="flex items-center space-x-2 bg-white px-4 py-2 rounded-lg shadow-sm border">
                    <div class="w-8 h-8 bg-success-100 rounded-full flex items-center justify-center">
                        <svg class="w-4 h-4 text-success-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <div>
                        <p class="text-xs font-medium text-neutral-900">RGPD</p>
                        <p class="text-xs text-neutral-600">Européen</p>
                    </div>
                </div>
                
                <div class="flex items-center space-x-2 bg-white px-4 py-2 rounded-lg shadow-sm border">
                    <div class="w-8 h-8 bg-warning-100 rounded-full flex items-center justify-center">
                        <svg class="w-4 h-4 text-warning-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <div>
                        <p class="text-xs font-medium text-neutral-900">CDP</p>
                        <p class="text-xs text-neutral-600">Sénégal</p>
                    </div>
                </div>
                
                <div class="flex items-center space-x-2 bg-white px-4 py-2 rounded-lg shadow-sm border">
                    <div class="w-8 h-8 bg-medic-100 rounded-full flex items-center justify-center">
                        <svg class="w-4 h-4 text-medic-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                        </svg>
                    </div>
                    <div>
                        <p class="text-xs font-medium text-neutral-900">SSL</p>
                        <p class="text-xs text-neutral-600">Sécurisé</p>
                    </div>
                </div>
            </div>

            <!-- Information de conformité -->
            <div class="bg-white p-4 rounded-lg shadow-sm border">
                <div class="flex items-start space-x-3">
                    <div class="w-6 h-6 bg-medic-100 rounded-full flex items-center justify-center mt-0.5">
                        <svg class="w-3 h-3 text-medic-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <div>
                        <h4 class="text-sm font-medium text-neutral-900 mb-1">Protection des Données</h4>
                        <p class="text-xs text-neutral-600 leading-relaxed">
                            Cette plateforme respecte les réglementations de la 
                            <strong>Commission de Protection des Données Personnelles (CDP) du Sénégal</strong> 
                            et le <strong>Règlement Général sur la Protection des Données (RGPD)</strong> européen. 
                            Vos données sont chiffrées et protégées selon les plus hauts standards de sécurité.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Liens légaux -->
            <div class="flex justify-center space-x-6 text-xs text-neutral-500">
                <a href="#" class="hover:text-medic-600 transition-colors">Politique de confidentialité</a>
                <a href="#" class="hover:text-medic-600 transition-colors">Conditions d'utilisation</a>
                <a href="#" class="hover:text-medic-600 transition-colors">Conformité CDP</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const btnVisiteur = document.getElementById('btn-visiteur');
    const btnAgentAdmin = document.getElementById('btn-agent-admin');
    const bandeau = document.getElementById('bandeau-info');
    const togglePassword = document.getElementById('toggle-password');
    const passwordInput = document.getElementById('id_password');
    const eyeOpen = document.getElementById('eye-open');
    const eyeClosed = document.getElementById('eye-closed');

    // Configuration des types de compte
    const accountTypes = {
        visiteur: {
            title: 'Compte Visiteur',
            description: 'Accès aux téléchargements sécurisés du Hub Public',
            icon: `<svg class="w-4 h-4 text-medic-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
            </svg>`,
            bgColor: 'bg-medic-50',
            borderColor: 'border-medic-200',
            textColor: 'text-medic-800'
        },
        agent: {
            title: 'Compte Agent/Administrateur',
            description: 'Accès complet aux fonctionnalités d\'anonymisation et de gestion',
            icon: `<svg class="w-4 h-4 text-medic-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
            </svg>`,
            bgColor: 'bg-medic-50',
            borderColor: 'border-medic-200',
            textColor: 'text-medic-800'
        }
    };

    // Fonction pour activer un type de compte
    function activateAccountType(activeBtn, inactiveBtn, type) {
        // Styles du bouton actif
        activeBtn.classList.add('bg-medic-500', 'text-white', 'shadow-sm');
        activeBtn.classList.remove('bg-neutral-50', 'text-neutral-600', 'hover:bg-neutral-100');
        
        // Styles du bouton inactif
        inactiveBtn.classList.add('bg-neutral-50', 'text-neutral-600', 'hover:bg-neutral-100');
        inactiveBtn.classList.remove('bg-medic-500', 'text-white', 'shadow-sm');

        // Mettre à jour le bandeau
        const config = accountTypes[type];
        bandeau.className = `mb-6 p-4 rounded-lg border ${config.bgColor} ${config.borderColor}`;
        bandeau.innerHTML = `
            <div class="flex items-center">
                <div class="w-8 h-8 bg-medic-100 rounded-full flex items-center justify-center mr-3">
                    ${config.icon}
                </div>
                <div>
                    <p class="text-sm font-medium ${config.textColor} mb-1">${config.title}</p>
                    <p class="text-xs text-medic-600">${config.description}</p>
                </div>
            </div>
        `;
    }

    // Gestionnaires d'événements
    btnVisiteur.addEventListener('click', function() {
        activateAccountType(btnVisiteur, btnAgentAdmin, 'visiteur');
    });

    btnAgentAdmin.addEventListener('click', function() {
        activateAccountType(btnAgentAdmin, btnVisiteur, 'agent');
    });

    // État initial
    activateAccountType(btnVisiteur, btnAgentAdmin, 'visiteur');

    // Fonctionnalité de basculement du mot de passe
    if (togglePassword && passwordInput) {
        togglePassword.addEventListener('click', function() {
            const isPassword = passwordInput.type === 'password';
            passwordInput.type = isPassword ? 'text' : 'password';
            
            eyeOpen.classList.toggle('hidden', !isPassword);
            eyeClosed.classList.toggle('hidden', isPassword);
        });
    }

    // Validation en temps réel
    const form = document.querySelector('form');
    const usernameInput = document.getElementById('id_username');
    const submitButton = form.querySelector('button[type="submit"]');

    function validateForm() {
        const username = usernameInput.value.trim();
        const password = passwordInput.value.trim();
        
        const isValid = username.length > 0 && password.length > 0;
        
        if (isValid) {
            submitButton.disabled = false;
            submitButton.classList.remove('opacity-50', 'cursor-not-allowed');
        } else {
            submitButton.disabled = true;
            submitButton.classList.add('opacity-50', 'cursor-not-allowed');
        }
    }

    // Validation initiale
    validateForm();

    // Événements de validation
    usernameInput.addEventListener('input', validateForm);
    passwordInput.addEventListener('input', validateForm);

    // Amélioration UX : focus automatique
    usernameInput.focus();

    // Gestion des erreurs de formulaire
    form.addEventListener('submit', function(e) {
        const submitBtn = e.target.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        
        submitBtn.disabled = true;
        submitBtn.innerHTML = `
            <svg class="w-5 h-5 mr-2 animate-spin" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Connexion en cours...
        `;
        
        // Restaurer après timeout en cas d'erreur
        setTimeout(() => {
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalText;
        }, 10000);
    });

    // Animation des badges de conformité
    const badges = document.querySelectorAll('[data-badge]');
    const observerOptions = {
        threshold: 0.5,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('fade-in');
            }
        });
    }, observerOptions);

    badges.forEach(badge => {
        observer.observe(badge);
    });
});

// Gestion des raccourcis clavier
document.addEventListener('keydown', function(e) {
    // Raccourci Alt+V pour basculer vers Visiteur
    if (e.altKey && e.key === 'v') {
        e.preventDefault();
        document.getElementById('btn-visiteur').click();
    }
    
    // Raccourci Alt+A pour basculer vers Agent/Admin
    if (e.altKey && e.key === 'a') {
        e.preventDefault();
        document.getElementById('btn-agent-admin').click();
    }
});
</script>

<style>
.account-type-btn {
    transition: all 0.2s ease-in-out;
}

.account-type-btn.active {
    transform: translateY(-1px);
}

.account-type-btn:hover {
    transform: translateY(-1px);
}

.form-input:focus {
    border-color: #0ea5e9;
    box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
}

.fade-in {
    animation: fadeIn 0.6s ease-out;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
</style>
{% endblock %}